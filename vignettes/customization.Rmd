---
title: "Customize your pkgdown website"
output: rmarkdown::html_vignette
description: >
  Learn how to change the look and feel of pkgdown websites.
vignette: >
  %\VignetteIndexEntry{Customize your pkgdown website}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(pkgdown)
```

You can alter the design/styling of your pkgdown website to suit your brand and needs. 
_Theming_ refers to being able to tweak colors, fonts, spacing etc. by using a Bootswatch template, Bootstrap variables, Bootstrap rules, or any custom CSS. 
_Layout_ refers to being able to change the content of say the navbar, authors page, `<head>` tag by using pkgdown configuration or pkgdown templates.

Another key concept related to styling your pkgdown website is whether you are tweaking _one_ package website, or several ones. 
In the latter case you might want to share your style files in the form of a package.

In this vignette we shall explain you the scope and tools for _theming_ and tweaking the _layout_ of pkgdown websites, and then explain how to best distribute your style when applied to more than one pkgdown website.
Depending on your use case, you might only need to read the sections "pre-requisite", "theming" and "navbar, footer, sidebar" to achieve your goals.

## Pre-requisite: update to Bootstrap 4!

Note that most theming features work only with Bootstrap 4, and that current development of pkgdown templates only happen for Bootstrap 4 templates. 
If you are reading this vignette, please take a moment to update your website to Boostrap 4.

```yaml
template:
  bootstrap: 4
```

This has low risk of breaking your site, but you should preview and double-check just to be sure.
Overall, the site should look pretty similar, but there will be a few minor improvements.
However, if you were managing your [own pkgdown templates](#layout) or custom CSS, you might need to tweak those.

## Theming

### Choosing a bootswatch theme

The easiest way to change the appearance of your website, or to start changing it, is to pick a complete bootswatch theme.
You can choose any [Bootswatch theme](https://bootswatch.com/) that's compatible with the Bootstrap version you use.
Run either `bslib::bootswatch_themes(3)` or `bslib::bootswatch_themes(4)` to get a list.
If you were using the paper theme, note that it was renamed [materia](https://blog.bootswatch.com/post/167233472837/announcing-bootswatch-400).

To choose a Bootswatch theme here's what to write in your `pkgdown` configuration.

```yaml
template:
  bootstrap: 4
  params:
    bootswatch: materia
```

**NB** : Some Bootswatch templates like lux or pulse won't work out of the box because of their tall navbar.
Add [CSS rules to prevent overlap with other elements](https://getbootstrap.com/docs/4.6/components/navbar/#placement) like [padding to the body](https://stackoverflow.com/questions/10336194/top-nav-bar-blocking-top-content-of-the-page), for instance in a file called `pkgdown/exta.css`.

### bslib variables

 Alternatively, you can customise the individual colours using [bslib variables](https://rstudio.github.io/bslib/articles/bs4-variables.html):

```yaml
template:
  bootstrap: 4
  params:
    bslib:
      bg: "#202123"
      fg: "#B8BCC2"
      primary: "#EA80FC"
      success: "#4F9B29"
      info: "#28B3ED"
      warning: "#FD7424"
      danger: "#F7367E"
```

### Why not both

You can also combine both approach and use both a Bootswatch theme and bslib variables.


```yaml
template:
  bootstrap: 4
  params:
    bootswatch: materia
    bslib:
      bg: "#202123"
      fg: "#B8BCC2"
      primary: "#EA80FC"
      success: "#4F9B29"
      info: "#28B3ED"
      warning: "#FD7424"
      danger: "#F7367E"
```

### Code highlighting in dark websites

By default pkgdown uses an accessible colour scheme for code highlighting... on a light background.
If you wish to opt out of this colour scheme to e.g. suit a dark Bootswatch theme better, here's what lines to add in your pkgdown configuration file:

```yaml
template:
  params:
    highlightcss: false
```

You will then have to provide your own CSS rules for highlighting code if you so wish, e.g. in `pkgdown/extra.css`.

## More CSS / JS / other assets

If you need to store more CSS rules or some JS code, the easiest
way is to add them in respectively`pkgdown/extra.css` and `pkgdown/extra.js`. 
These will be automatically copied to `docs/` and inserted into the
`<head>` after the default pkgdown CSS and JS.

If you e.g. need an SVG used by your CSS, Store the files under `pkgdown/assets/BS4` (if you're using Bootstrap 4), it will be copied to the root of your website folder by pkgdown (by `init_site()`).

If you use the folder `pkgdown/`, do not forget to [.Rbuildignore](https://r-pkgs.org/package-structure-state.html?q=rbuild#rbuildignore) it.


## Navbar, footer, home sidebar

The navbar, footer and home sidebar can be tweaked via the pkgdown configuration file of your website.

### Navbar

```{r child="../man/rmd-fragments/navbar-configuration.Rmd"}
```

### Footer

```{r child="../man/rmd-fragments/footer-configuration.Rmd"}
```

### Sidebar

```{r child = "../man/rmd-fragments/sidebar-sources.Rmd"}
```

```{r child = "../man/rmd-fragments/sidebar-configuration.Rmd"}
```

## Other layouts changes

Other changes of layouts require tinkering with pkgdown _templates_ (in `inst/templates` in [pkgdown source](https://github.com/r-lib/pkgdown)).

You can override the default templates (cf `?build_site`).
For any template for which you have **not** provided a replacement, pkgdown will use the default template (corresponding to the right Bootstrap version) so you only need to provide pkgdown with the templates you _have_ tweaked.

Three of pkgdown templates are meant to be customized:

* "in-header.html" inserted right before closing the head tag, 
* "before-body.html" inserted right after opening the body tag,
* "after-body.html" inserted right before closing the body tag.

Overriding other templates is recommended for advanced users only.
Furthermore, maintaining e.g. your own "head.html" template requires more work as you might need to keep it up-to-date with upstream changes in pkgdown itself whereas "in-header.html", "before-body.html" and "after-body.html" are by default empty.
If you've used head.html in the past, we now recommend switching to using "in-header.html" instead.

### Tweaking the templates meant for customization

* Create a folder `inst/pkgdown/templates` (or use another method to override templates).
* Create an HTML file "in-header.html", "before-body.html" or "after-body.html" in that folder, depending on your needs. E.g. you could save the lines corresponding to your analytics provider, if not Google Analytics, in `inst/pkgdown/templates/in-header.html`.
* Edit and save that file.
* Re-build your website, inspect it (and its source, if needed).

### Tweaking other templates (advanced users only)

The main difference compared to using empty templates meant for customization is that you will need to learn a bit about whisker, the R implementation of [Mustache](https://mustache.github.io/mustache.5.html); and that you might need to update your templates with upstream changes in the future.

* To find what template to edit, study the contents of pkgdown's templates folder (`inst/templates/BS4` for Bootstrap 4, `inst/templates/BS3` for Bootstrap 3). The skeleton of pages is provided in "layout.html" so start there.
* Create a folder `inst/pkgdown/templates` (or use another method to override templates).
* Copy the template(s) you need to tweak into that folder, edit and save them.
* Re-build your website, inspect it (and its source, if needed).

### General caveat

A limitation to tweaking templates is that, for anything not hard-coded, your templates can only use data that pkgdown passes to templates.
Make sure you read the documentation of `render_page()` as well as its source code.

## Sharing pkgdown styles: template packages

To share a pkgdown style across several packages, the best workflow is to create... a package!

It might contain any of the following, under `inst/pkgdown`

* a configuration file in `inst/pkgdown/_pkgdown.yml`;
* templates in `inst/pkgdown/templates/BS4`;
* assets in `inst/pkgdown/assets/BS4`.

Once you have created your template package `theverybest`, to build a pkgdown website with it, what's needed is

* for `theverybest` to be installed. In `DESCRIPTION` the packages using it could have these lines (in particular if your continuous integration workflow uses pak or remotes).

```
Config/Needs/website:
    theverybest
```

* for the pkgdown configuration file to feature these lines:

```yaml
template:
  package: theverybest
```

### Configuration file in a template package

Allow template packages to provide a default configuration `_pkgdown.yml`, 
stored in `inst/pkgdown/_pkgdown.yml`. This can be used to set (e.g.) author 
definitions, Bootstrap version and variables, the sidebar, footer, navbar, etc.

Configuration parameters supplied by a template package have the lowest priority
They will be overridden by a local `_pkgdown.yml` which is in turn overridden by
`override` parameter of `build_site()`. 

### Examples

Note that the pkgdown website of pkgdown itself is customized as little as possible.

Here is a list of examples of template packages that you can use as inspiration but that you cannot use directly as they are aimed at a specific subset of packages.

* [tidytemplate](https://tidytemplate.tidyverse.org/) used for tidyverse and tidymodels packages;
* [quillt](https://pkgs.rstudio.com/quillt) used for R Markdown packages;
* [rotemplate](https://github.com/ropensci-org/rotemplate) used for rOpenSci packages.

## How to craft and preview style tweaks

When crafting a new style you will need to re-build your website quite often.
How to have a faster workflow?

* Use a simpler package for previewing your style. This might be over the top for a single package but if you are working on a template package, the template package can contain minimal vignettes, reference pages for testing!
* Do not rebuild your package every time: e.g. only re-build the home page via `build_home()` to get a preview of the home sidebar, or of the footer and navbar.
* If you edit CSS, you can run `init_site()` to have them copied to your website folder, and then refresh the website in your browser.

## Conclusion

In this vignette we explained how to change the theming and layout of pkgdown websites.
Further work to improve user experience is:

* working on the articles index (cf `?build_articles`) and on the reference index (cf `?build_reference`);
* improving the contents of your documentation themselves! 😉
